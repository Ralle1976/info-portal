{% extends "base.html" %}

{% block content %}
<!-- Skip Links -->
<div class="sr-only">
  <a href="#status-section" class="skip-links">Skip to status</a>
  <a href="#hours-section" class="skip-links">Skip to hours</a>
  <a href="#contact-section" class="skip-links">Skip to contact</a>
</div>

<!-- Status Banner Enhanced with New Design System -->
{% if status %}
<section id="status-section" aria-labelledby="status-heading" class="mb-8">
  <div class="status-banner {% if status.type == 'ANWESEND' %}status-banner-open{% else %}status-banner-warning{% endif %}">
    <div class="flex items-start gap-6">
      <!-- Status Icon -->
      <div class="status-icon-container flex-shrink-0">
        <div class="status-icon {% if status.type == 'ANWESEND' %}status-icon-open{% else %}status-icon-warning{% endif %}">
          <i class="fas {% if status.type == 'ANWESEND' %}fa-door-open{% else %}fa-calendar-times{% endif %}" aria-hidden="true"></i>
        </div>
      </div>
      
      <!-- Status Content -->
      <div class="flex-1">
        <h2 id="status-heading" class="heading-3 mb-2">
          {{ get_translation('status') }}: 
          {% if status.type == 'ANWESEND' %}
            {{ get_translation('open') }}
          {% elif status.type == 'URLAUB' %}
            {{ get_translation('on_vacation') }}
          {% elif status.type == 'BILDUNGSURLAUB' %}
            {{ get_translation('educational_leave') }}
          {% elif status.type == 'KONGRESS' %}
            {{ get_translation('congress') }}
          {% else %}
            {{ get_translation('other') }}
          {% endif %}
        </h2>
        
        {% if status.description %}
          <p class="body-base text-gray-700 mb-3">{{ status.description }}</p>
        {% endif %}
        
        {% if status.next_return %}
          <div class="flex items-center gap-2 text-gray-600">
            <i class="fas fa-calendar-check" aria-hidden="true"></i>
            <span class="body-small">{{ get_translation('back_on') }}: {{ status.next_return.strftime('%d.%m.%Y') }}</span>
          </div>
        {% endif %}
      </div>
      
      <!-- Live Status Indicator -->
      {% if status.type == 'ANWESEND' %}
        <div class="status-indicator status-open">
          <span class="status-indicator-dot" aria-hidden="true"></span>
          <span>{{ get_translation('ui_common.available_now') }}</span>
        </div>
      {% endif %}
    </div>
  </div>
</section>
{% endif %}

<!-- Today's Hours Section -->
<section id="hours-section" aria-labelledby="hours-heading" class="mb-8">
  <div class="card card-medical-enhanced">
    <!-- Card Header with Icon -->
    <div class="card-icon-header">
      <div class="card-icon">
        <i class="fas fa-clock" aria-hidden="true"></i>
      </div>
      <div class="flex-1">
        <h2 id="hours-heading" class="heading-3 mb-1">{{ get_translation('today') }}</h2>
        <p class="body-small text-gray-600">{{ today.strftime('%d.%m.%Y') }}</p>
      </div>
      <!-- Live Clock Display -->
      <div class="text-right">
        <div class="time-display-large" id="live-time" aria-live="polite" aria-label="Current time">
          --:--:--
        </div>
      </div>
    </div>
    
    <!-- Card Body -->
    <div class="card-body">
      {% if today_hours.closed %}
        <!-- Closed Status -->
        <div class="text-center py-8">
          <div class="inline-flex items-center justify-center w-20 h-20 bg-red-100 rounded-full mb-4">
            <i class="fas fa-door-closed text-red-600 text-3xl" aria-hidden="true"></i>
          </div>
          <div class="heading-4 text-red-600 mb-3">{{ get_translation('closed') }}</div>
          {% if today_hours.note %}
            <div class="alert-medical alert-medical-info">
              <div class="alert-icon">
                <i class="fas fa-info-circle" aria-hidden="true"></i>
              </div>
              <div class="alert-content">
                <div class="alert-message">{{ today_hours.note }}</div>
              </div>
            </div>
          {% endif %}
        </div>
      {% else %}
        <!-- Open Hours -->
        <div class="space-y-4">
          <h3 class="heading-5 flex items-center gap-2">
            <i class="fas fa-calendar-day text-primary" aria-hidden="true"></i>
            {{ get_translation('ui_common.todays_hours') }}
          </h3>
          
          <div class="grid gap-3">
            {% for time_range in today_hours.time_ranges %}
              <div class="card-interactive-enhanced bg-gray-50 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="inline-flex items-center justify-center w-10 h-10 bg-green-100 rounded-full">
                      <i class="fas fa-clock text-green-600" aria-hidden="true"></i>
                    </div>
                    <span class="body-large font-medium">{{ time_range }}</span>
                  </div>
                  
                  {% if is_open %}
                    <div class="status-indicator status-open">
                      <span class="status-indicator-dot" aria-hidden="true"></span>
                      <i class="fas fa-check" aria-hidden="true"></i>
                      <span>{{ get_translation('ui_common.currently_open_status') }}</span>
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      
      <!-- Next Available -->
      {% if next_open and not is_open %}
        <div class="mt-6">
          <div class="alert-medical alert-medical-info">
            <div class="alert-icon">
              <i class="fas fa-calendar-alt" aria-hidden="true"></i>
            </div>
            <div class="alert-content">
              <div class="alert-title">{{ get_translation('next_available') }}</div>
              <div class="alert-message">
                {{ next_open.date.strftime('%d.%m.%Y') }} um {{ next_open.time }}
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- Announcements Section -->
{% if announcements %}
<section aria-labelledby="announcements-heading" class="mb-8">
  <h2 id="announcements-heading" class="heading-3 mb-4">{{ get_translation('announcements') }}</h2>
  <div class="space-y-4">
    {% for announcement in announcements %}
      <div class="alert-medical alert-medical-info animate-slide-up">
        <div class="alert-icon">
          <i class="fas fa-bullhorn" aria-hidden="true"></i>
        </div>
        <div class="alert-content">
          <div class="alert-title">{{ announcement.title }}</div>
          <div class="alert-message">{{ announcement.body }}</div>
        </div>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- Services Section -->
<section aria-labelledby="services-heading" class="mb-8">
  <div class="card card-medical-enhanced">
    <div class="card-icon-header">
      <div class="card-icon">
        <i class="fas fa-stethoscope" aria-hidden="true"></i>
      </div>
      <div>
        <h2 id="services-heading" class="heading-3 mb-1">{{ get_translation('services') }}</h2>
        <p class="body-small text-gray-600">{{ get_translation('ui_common.standard_services') }}</p>
      </div>
    </div>
    
    <div class="card-body">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for service in ['blood_test', 'consultation', 'follow_up', 'health_check'] %}
          <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <div class="inline-flex items-center justify-center w-10 h-10 bg-primary text-white rounded-full">
              <i class="fas fa-check" aria-hidden="true"></i>
            </div>
            <span class="body-base font-medium">{{ get_translation(service) }}</span>
          </div>
        {% endfor %}
      </div>
      
      <div class="mt-4 p-4 bg-blue-50 rounded-lg">
        <p class="body-small text-blue-800 text-center">
          <i class="fas fa-info-circle mr-2" aria-hidden="true"></i>
          {{ get_translation('ui_common.additional_services_on_request') }}
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Contact & Location Section -->
<section id="contact-section" aria-labelledby="contact-heading" class="mb-8">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    
    <!-- Contact Information -->
    <div class="card card-medical-enhanced">
      <div class="card-icon-header">
        <div class="card-icon">
          <i class="fas fa-phone" aria-hidden="true"></i>
        </div>
        <div>
          <h2 id="contact-heading" class="heading-3 mb-1">{{ get_translation('contact') }}</h2>
          <p class="body-small text-gray-600">{{ get_translation('ui_common.get_in_touch') }}</p>
        </div>
      </div>
      
      <div class="card-body space-y-4">
        <!-- Phone -->
        <a href="tel:+66123456789" class="btn btn-outline flex items-center gap-3 w-full justify-start">
          <i class="fas fa-phone text-primary" aria-hidden="true"></i>
          <div class="text-left">
            <div class="font-medium">+66 123 456 789</div>
            <div class="text-sm text-gray-500">{{ get_translation('ui_common.call_now') }}</div>
          </div>
        </a>
        
        <!-- Email -->
        <a href="mailto:info@laborpattaya.com" class="btn btn-outline flex items-center gap-3 w-full justify-start">
          <i class="fas fa-envelope text-primary" aria-hidden="true"></i>
          <div class="text-left">
            <div class="font-medium">info@laborpattaya.com</div>
            <div class="text-sm text-gray-500">{{ get_translation('ui_common.send_email') }}</div>
          </div>
        </a>
        
        <!-- Address -->
        <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
          <i class="fas fa-map-marker-alt text-primary mt-1" aria-hidden="true"></i>
          <div>
            <div class="font-medium">Labor Pattaya</div>
            <div class="text-sm text-gray-600">
              123 Healthcare Street<br>
              Pattaya, Thailand 20150
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- QR Code & Navigation -->
    <div class="card card-medical-enhanced">
      <div class="card-icon-header">
        <div class="card-icon">
          <i class="fas fa-qrcode" aria-hidden="true"></i>
        </div>
        <div>
          <h2 class="heading-3 mb-1">{{ get_translation('ui_common.qr_portal') }}</h2>
          <p class="body-small text-gray-600">{{ get_translation('ui_common.scan_for_info') }}</p>
        </div>
      </div>
      
      <div class="card-body">
        <!-- QR Code -->
        <div class="qr-container-enhanced mb-6">
          <div class="qr-code-enhanced">
            <img src="{{ url_for('public.qr_code', size=200) }}" 
                 alt="QR Code for Portal Access" 
                 width="200" height="200">
          </div>
          <p class="body-small text-gray-600 mt-2">{{ get_translation('ui_common.scan_smartphone') }}</p>
        </div>
        
        <!-- Map Link -->
        <a href="https://maps.google.com/?q=12.923556,100.882507" 
           target="_blank" rel="noopener noreferrer"
           class="btn btn-primary w-full">
          <i class="fas fa-map mr-2" aria-hidden="true"></i>
          {{ get_translation('ui_common.view_on_map') }}
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Weekly Quick View -->
<section aria-labelledby="quick-view-heading" class="mb-8">
  <div class="card card-medical-enhanced">
    <div class="card-header">
      <div class="flex items-center justify-between">
        <h2 id="quick-view-heading" class="heading-3">{{ get_translation('ui_common.this_week') }}</h2>
        <a href="{{ url_for('public.week_view') }}" class="btn btn-sm btn-outline">
          {{ get_translation('view_full_week') }}
          <i class="fas fa-arrow-right ml-2" aria-hidden="true"></i>
        </a>
      </div>
    </div>
    
    <div class="card-body">
      <div class="grid grid-cols-2 md:grid-cols-7 gap-2">
        {% set days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
        {% for day in days %}
          <div class="text-center p-3 rounded-lg {% if loop.index == 1 %}bg-primary text-white{% else %}bg-gray-50{% endif %}">
            <div class="font-semibold text-sm">{{ day }}</div>
            <div class="text-xs mt-1">
              {% if loop.index <= 5 %}
                08:30-16:00
              {% elif loop.index == 6 %}
                09:00-13:00
              {% else %}
                {{ get_translation('closed') }}
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Enhanced homepage interactions
document.addEventListener('DOMContentLoaded', function() {
  // Initialize enhanced time display
  initializeEnhancedClock();
  
  // Add interactive card effects
  initializeCardInteractions();
  
  // Initialize status updates
  initializeStatusUpdates();
});

function initializeEnhancedClock() {
  const clockElement = document.getElementById('live-time');
  if (!clockElement) return;
  
  function updateClock() {
    const now = new Date();
    const bangkokTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Bangkok"}));
    
    const hours = String(bangkokTime.getHours()).padStart(2, '0');
    const minutes = String(bangkokTime.getMinutes()).padStart(2, '0');
    const seconds = String(bangkokTime.getSeconds()).padStart(2, '0');
    
    clockElement.innerHTML = `${hours}<span class="time-separator">:</span>${minutes}<span class="time-separator">:</span>${seconds}`;
  }
  
  updateClock();
  setInterval(updateClock, 1000);
}

function initializeCardInteractions() {
  // Add ripple effect to interactive cards
  document.querySelectorAll('.card-interactive-enhanced').forEach(card => {
    card.addEventListener('click', function(e) {
      const ripple = document.createElement('span');
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;
      
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = x + 'px';
      ripple.style.top = y + 'px';
      ripple.className = 'ripple';
      
      this.appendChild(ripple);
      
      setTimeout(() => {
        ripple.remove();
      }, 600);
    });
  });
}

function initializeStatusUpdates() {
  // Check for status updates every 5 minutes
  setInterval(async () => {
    try {
      const response = await fetch('/api/status-check');
      const data = await response.json();
      
      if (data.hasUpdate) {
        DesignSystem.showNotification(
          '{{ get_translation("ui_common.status_updated") }}', 
          'info', 
          3000
        );
      }
    } catch (error) {
      console.log('Status check failed:', error);
    }
  }, 300000); // 5 minutes
}
</script>

<style>
/* Additional homepage-specific styles */
.ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(0, 206, 209, 0.3);
  transform: scale(0);
  animation: ripple 0.6s linear;
  pointer-events: none;
}

@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

/* Enhanced status banner animations */
.status-banner {
  background-attachment: fixed;
  background-size: 200% 200%;
  animation: gradientShift 10s ease infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Improved focus states */
.btn:focus-visible,
a:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 2px;
  box-shadow: 0 0 0 6px rgba(0, 206, 209, 0.2);
}
</style>
{% endblock %}